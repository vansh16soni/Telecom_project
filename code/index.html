<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Telecom Network Dashboard | Analytics</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root {
  --primary: #6366f1;
  --secondary: #a855f7;
  --accent: #f43f5e;
  --bg: #0f172a;
  --card-bg: rgba(30, 41, 59, 0.7);
  --text: #f8fafc;
}

body {
  font-family: 'Segoe UI', Roboto, sans-serif;
  background: radial-gradient(circle at top right, #1e1b4b, #0f172a);
  color: var(--text);
  margin: 0;
  padding: 20px;
  min-height: 100vh;
}

h1 {
  text-align: center;
  font-weight: 800;
  letter-spacing: -1px;
  background: linear-gradient(to right, #818cf8, #d946ef);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  margin-bottom: 30px;
}

.container {
  max-width: 1200px;
  margin: auto;
}

/* KPI Section */
.kpi-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.kpi-card {
  background: var(--card-bg);
  padding: 20px;
  border-radius: 16px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  text-align: center;
  backdrop-filter: blur(10px);
}

.kpi-card h4 { margin: 0; color: #94a3b8; font-size: 0.9rem; }
.kpi-card p { margin: 10px 0 0; font-size: 1.8rem; font-weight: bold; color: var(--text); }

/* Controls */
.filter-card {
  background: var(--card-bg);
  padding: 15px 25px;
  border-radius: 50px;
  display: flex;
  align-items: center;
  gap: 15px;
  margin-bottom: 30px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  width: fit-content;
  margin-left: auto;
  margin-right: auto;
}

select {
  background: #334155;
  color: white;
  border: none;
  padding: 8px 15px;
  border-radius: 20px;
  outline: none;
  cursor: pointer;
}

/* Dashboard Layout */
.grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 25px;
}

.card {
  background: var(--card-bg);
  padding: 25px;
  border-radius: 24px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  backdrop-filter: blur(10px);
}

.card h3 { margin-top: 0; font-weight: 600; color: #cbd5e1; border-left: 4px solid var(--primary); padding-left: 10px; }

/* Table Styling */
.table-container {
  grid-column: span 2;
  overflow-x: auto;
}

table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0 8px;
}

th {
  text-align: left;
  padding: 15px;
  color: #94a3b8;
  font-weight: 500;
}

td {
  padding: 15px;
  background: rgba(255,255,255,0.03);
}

tr td:first-child { border-radius: 12px 0 0 12px; }
tr td:last-child { border-radius: 0 12px 12px 0; }

canvas { max-height: 350px; }

@media (max-width: 900px) { .grid { grid-template-columns: 1fr; } .table-container { grid-column: span 1; } }
</style>
</head>

<body>

<div class="container">
  <h1>ðŸ“¡ Network Quality Analysis Dashboard</h1>

  <div class="filter-card">
    <label>Select Focus Region:</label>
    <select id="regionFilter">
      <option value="all">Global Overview</option>
    </select>
  </div>

  <div class="kpi-row">
    <div class="kpi-card">
      <h4>Avg Latency</h4>
      <p id="kpi-latency">--</p>
    </div>
    <div class="kpi-card">
      <h4>Avg ARPU</h4>
      <p id="kpi-arpu">--</p>
    </div>
    <div class="kpi-card">
      <h4>Total Complaints</h4>
      <p id="kpi-complaints">--</p>
    </div>
  </div>

  <div class="grid">
    <div class="card">
      <h3>Revenue vs Service Quality</h3>
      <canvas id="scatterChart"></canvas>
    </div>

    <div class="card">
      <h3>Regional Revenue Distribution</h3>
      <canvas id="barChart"></canvas>
    </div>

    <div class="card table-container">
      <h3>Master Network Dataset</h3>
      <table id="dataTable">
        <thead>
          <tr id="tableHead"></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>

<script>
let globalData = [];
let scatterChart, barChart;

async function loadCSV() {
  // Replace this URL with your actual file path
  const response = await fetch("network_master.csv");
  const data = await response.text();

  const rows = data.trim().split("\n");
  const headers = rows[0].split(",");

  globalData = rows.slice(1).map(row => {
    const values = row.split(",");
    let obj = {};
    headers.forEach((h, i) => obj[h.trim()] = values[i]);
    return obj;
  }).filter(r => r.region);

  populateFilter();
  updateDashboard(globalData);
}

function populateFilter() {
  const regions = [...new Set(globalData.map(d => d.region))];
  const filter = document.getElementById("regionFilter");

  regions.forEach(r => {
    let opt = document.createElement("option");
    opt.value = r;
    opt.textContent = r;
    filter.appendChild(opt);
  });

  filter.addEventListener("change", () => {
    const val = filter.value;
    const filtered = val === "all" ? globalData : 
                     globalData.filter(d => d.region === val);
    updateDashboard(filtered);
  });
}

function updateKPIs(data) {
  const avgLat = data.reduce((s, r) => s + Number(r.latency_ms), 0) / data.length;
  const avgArpu = data.reduce((s, r) => s + Number(r.ARPU), 0) / data.length;
  const totalComp = data.reduce((s, r) => s + Number(r.complaints), 0);

  document.getElementById("kpi-latency").textContent = `${avgLat.toFixed(1)} ms`;
  document.getElementById("kpi-arpu").textContent = `$${avgArpu.toFixed(0)}`;
  document.getElementById("kpi-complaints").textContent = totalComp;
}

function renderTable(data) {
  const tbody = document.querySelector("#dataTable tbody");
  const thead = document.getElementById("tableHead");
  tbody.innerHTML = ""; thead.innerHTML = "";

  if (data.length === 0) return;

  Object.keys(data[0]).forEach(h => {
    let th = document.createElement("th");
    th.textContent = h.toUpperCase();
    thead.appendChild(th);
  });

  data.forEach(row => {
    let tr = document.createElement("tr");
    Object.values(row).forEach(val => {
      let td = document.createElement("td");
      td.textContent = val;
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
}

function drawCharts(data) {
  const latency = data.map(d => Number(d.latency_ms));
  const arpu = data.map(d => Number(d.ARPU));
  const regions = data.map(d => d.region);

  if (scatterChart) scatterChart.destroy();
  if (barChart) barChart.destroy();

  const ctxS = document.getElementById("scatterChart").getContext('2d');
  const gradientS = ctxS.createLinearGradient(0, 0, 0, 400);
  gradientS.addColorStop(0, 'rgba(99, 102, 241, 0.5)');
  gradientS.addColorStop(1, 'rgba(168, 85, 247, 0.1)');

  scatterChart = new Chart(ctxS, {
    type: 'scatter',
    data: {
      datasets: [{
        label: "ARPU vs Latency",
        data: latency.map((l, i) => ({x: l, y: arpu[i]})),
        backgroundColor: '#f43f5e',
        borderColor: '#fff',
        pointRadius: 6,
        pointHoverRadius: 10
      }]
    },
    options: {
      plugins: { legend: { labels: { color: '#fff' } } },
      scales: {
        x: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#94a3b8' }, title: { display: true, text: 'Latency (ms)', color: '#fff' } },
        y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#94a3b8' }, title: { display: true, text: 'ARPU ($)', color: '#fff' } }
      }
    }
  });

  const ctxB = document.getElementById("barChart").getContext('2d');
  barChart = new Chart(ctxB, {
    type: 'bar',
    data: {
      labels: regions,
      datasets: [{
        label: "Regional ARPU",
        data: arpu,
        backgroundColor: 'rgba(99, 102, 241, 0.7)',
        borderRadius: 8,
        hoverBackgroundColor: '#a855f7'
      }]
    },
    options: {
      plugins: { legend: { display: false } },
      scales: {
        x: { grid: { display: false }, ticks: { color: '#94a3b8' } },
        y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#94a3b8' } }
      }
    }
  });
}

function updateDashboard(data) {
  updateKPIs(data);
  renderTable(data);
  drawCharts(data);
}

loadCSV();
</script>

</body>
</html>